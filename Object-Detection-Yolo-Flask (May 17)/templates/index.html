<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Object Detection Application</title>
    <style>
        /* Basic body styling */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a2e; /* Dark background */
            color: #ffffff; /* White text */
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* Container styling with RGB inside effect and blue box shadow */
        .container, .search-container {
            background-color: #2a2a4a; /* This color will show in the padding area (the "border") */
            padding: 30px; /* This padding creates the space for the solid color "border" */
            border-radius: 15px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 700px;
            box-sizing: border-box;
            position: relative; /* Needed for stacking context if using pseudo-elements for other effects */
            overflow: hidden; /* Prevents gradient animation from overflowing corners */
            z-index: 1; /* Ensure content is above potential backgrounds */

            /* Blue Box Shadow */
            box-shadow: 0 0 20px rgba(0, 123, 255, 0.6); /* Blue glow shadow */

            /* RGB Gradient Inside */
            background-image: repeating-linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            background-size: 400% 400%; /* Make the gradient larger to animate */
            background-origin: content-box; /* Start the background from the edge of the content box */
            background-clip: content-box; /* Clip the background to the content box */
            animation: rgb-glow 15s ease infinite; /* Animation for the gradient background */
        }

        /* Removed the ::before pseudo-element styles */

        @keyframes rgb-glow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Headings styling */
        h1, h2 {
            color: #00bfff; /* Deep Sky Blue */
            text-align: center;
            margin-bottom: 20px;
        }

        /* Form and input styling */
        form {
            margin-bottom: 20px;
            text-align: center; /* Center form elements */
        }

        label {
            display: block; /* Make labels block elements for better spacing */
            margin-bottom: 10px;
            color: #add8e6; /* Light blue for labels */
            font-weight: bold;
        }

        /* Style for file input - often tricky to style directly */
        /* We will style the label and hide the actual input */
        input[type="file"] {
             /* Hide the default file input */
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }

        /* Style the label associated with the file input (acts as the button) */
        input[type="file"] + label {
            display: inline-block; /* Make it look like a button */
            background-color: #007bff; /* Blue background */
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        input[type="file"] + label:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }

        /* Styling for the output image */
        #output-image {
            max-width: 100%;
            height: auto;
            display: block; /* Center the image */
            margin: 20px auto;
            border: 2px solid #007bff; /* Blue border around the image */
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5); /* Blue glow effect */
        }

        /* Styling for the analysis div */
        #analysis {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #3a3a5a; /* Subtle separator */
            color: #add8e6; /* Light blue text */
        }

        #analysis h3 {
            color: #00bfff; /* Deep Sky Blue */
            margin-bottom: 10px;
        }

        #analysis ul {
            list-style: none; /* Remove default bullet points */
            padding: 0;
        }

        #analysis li {
            background-color: #3a3a5a; /* Slightly darker background for list items */
            margin-bottom: 5px;
            padding: 8px 15px;
            border-radius: 5px;
            border-left: 3px solid #007bff; /* Blue left border */
        }

        /* Styling for search results images */
        .processed-image {
            max-width: 200px; /* Keep fixed width as in your script */
            height: auto;
            margin: 10px;
            border: 2px solid #007bff; /* Blue border */
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.4); /* Blue glow */
            display: inline-block; /* Display images in a row */
        }

        /* Ensure the second div has the same container styling */
        body > div:nth-of-type(2) {
            margin-top: 20px; /* Add space between the two sections */
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Image Object Detection</h1>
        <form id="upload-form" action="/object-detection/" method="post" enctype="multipart/form-data">
            <label for="image">Select Image:</label>
            <input type="file" id="image" name="image" accept="image/*" required>
        </form>
        <br>
        <h2>Output Image:</h2>
        <img id="output-image" src="" alt="Processed Image">
        <div id="analysis"></div>
    </div>

    <div class="search-container">
        <h2>Search Image:</h2>
        <form id="search-form" action="/search/" method="post" enctype="multipart/form-data">
            <label for="search-image">Select Image:</label>
            <input type="file" id="search-image" name="search-image" accept="image/*" required>
        </form>
         <div id="search-results"></div>
    </div>


    <script>
        const fileInput = document.getElementById('image');
        const form = document.getElementById('upload-form');
        const searchFileInput = document.getElementById('search-image');
        const searchForm = document.getElementById('search-form');
        const searchResultsDiv = document.getElementById('search-results'); // Get the search results div

        fileInput.addEventListener('change', async function() {
            if (fileInput.files.length > 0) {
                const formData = new FormData();
                formData.append('image', fileInput.files[0]); // Add the file manually to FormData

                console.log("Uploading file:", fileInput.files[0]); // Debug log

                const response = await fetch('/object-detection/', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log("Response data:", data); // Debug log

                    // Display the processed image
                    const outputImage = document.getElementById('output-image');
                    outputImage.src = `data:image/png;base64,${data.image}`;

                    // Display detected objects
                    const analysis = document.getElementById('analysis');
                    analysis.innerHTML = `<h3>Detected Objects:</h3><ul>${data.detected_objects.map(obj => `<li>${obj}</li>`).join('')}</ul>`;
                } else {
                    console.error('Failed to process image');
                    // Optionally display an error message to the user
                }
            } else {
                console.error('No file selected');
                 // Optionally display a message asking the user to select a file
            }
        });

        searchFileInput.addEventListener('change', async function() {
            if (searchFileInput.files.length > 0) {
                const formData = new FormData(searchForm);
                const response = await fetch('/search/', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log("Search Response data:", data); // Debug log

                    // Clear previous search results
                    searchResultsDiv.innerHTML = '';

                    // Display detected objects
                    if (data.images && data.images.length > 0) {
                         data.images.forEach((image, index) => {
                            const imgElement = document.createElement('img');
                            imgElement.src = `/images/${image}`;
                            imgElement.alt = `Processed Image ${index + 1}`;
                            imgElement.className = 'processed-image'; // Add a class for styling
                            searchResultsDiv.appendChild(imgElement); // Append to the search results div
                        });
                    } else {
                         searchResultsDiv.innerHTML = '<p>No matching images found.</p>';
                    }

                } else {
                    console.error('Failed to process search image');
                     // Optionally display an error message to the user
                     searchResultsDiv.innerHTML = '<p>Error processing search. Please try again.</p>';
                }
            } else {
                console.error('No search file selected');
                 // Optionally display a message asking the user to select a file
            }
        });
    </script>
</body>
</html>